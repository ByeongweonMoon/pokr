{% macro people_list_pagenav(people, page=None, pagesize=None) -%}
    <div class="float-list">
        {% call(person) list_pagenav(people, page=page, pagesize=pagesize) %}
            {{widgets.card(person)|safe}}
        {% endcall %}
    </div>
{%- endmacro %}

{% macro people_list_more(people, url, pagesize=None) -%}
    <div class="float-list">
        {% call(person) list_more(people, url, pagesize=pagesize) %}
            {{widgets.card(person)|safe}}
        {% endcall %}
    </div>
{%- endmacro %}

{% macro btn_show(target, show=None, hide=None) -%}
{% set show = show or gettext('show') %}
{% set hide = hide or gettext('hide') %}
<a href="#" class="btn-show" data-target="{{target}}">
    <span class="text-show">{{show}}</span><span class="text-hide">{{hide}}</span>
</a>
{%- endmacro %}

{% macro list_count(query, type=None) -%}
    {% set cnt = query|count if hasattr(query, 'append') else query.count() %}
    <span class="search-count">{% if type=='people' %}{{ gettext('%(count)d people', count=cnt) }}{% else %}{{ gettext('%(count)d results', count=cnt) }}{% endif %}</span>
{%- endmacro %}

{% macro list_pagenav(query, page=None, pagesize=None, layout='list') -%}
    {% set page = int(request.args.get('page', 1)) %}
    {% set pagesize = pagesize or 20 %}
    {% set prev_url = url_for_query(page=max(1, page - 1)) %}
    {% set next_url = url_for_query(page=page + 1) %}
    {% set offset = (page - 1) * pagesize %}
    {% set items = query.offset(offset).limit(pagesize+1).all() %}

    {% if layout=='list' %}
        <ul>
        {% for item in items[:pagesize] %}
            <li>{{caller(item)}}</li>
        {% endfor %}
        </ul>
    {% elif layout=='table' %}
        <table class="table table-condensed">
        {% for item in items[:pagesize] %}
            <tr>{{caller(item)}}</tr>
        {% endfor %}
        </table>
    {% endif %}

    <div class="pagenav">
        {% if offset %}
            <a class="btn btn-pagenav btn-prev" href="{{prev_url}}"><i class="icon-angle-left"></i> {{gettext('prev')}}</a>
        {% endif %}
        <div style="text-align: center;">{{ gettext('page %(page)d', page=page) }}</div>
        {% if items|count > pagesize %}
            <a class="btn btn-pagenav btn-next" href="{{next_url}}">{{gettext('next')}} <i class="icon-angle-right"></i></a>
        {% endif %}
    </div>
{%- endmacro %}

{% macro list_more(query, url, pagesize=None, layout='list') -%}
    {% set pagesize = pagesize or 20 %}
    {% set items = query.limit(pagesize+1).all() %}

    {% if layout=='list' %}
        <ul>
        {% for item in items[:pagesize] %}
            <li>{{caller(item)}}</li>
        {% endfor %}
        </ul>
    {% elif layout=='table' %}
        <table class="table table-condensed">
        {% for item in items[:pagesize] %}
            <tr>{{caller(item)}}</tr>
        {% endfor %}
        </table>
    {% endif %}

    {% if items|count > pagesize %}
    <a class="btn-more" href="{{ url }}">{{ gettext('more') }}</a>
    {% endif %}
{%- endmacro %}
