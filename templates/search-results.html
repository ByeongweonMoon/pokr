{% extends 'layout.html' %}
{% import 'macros.html' as macro with context %}

{% set target = request.args.get('target') %}
{% macro search_options() -%}
    {% set options = [('year', gettext('birthyear')),
                      ('query', gettext('query')),
                      ('school_id', gettext('school')),
                      ('person_id', gettext('person')),
                      ('assembly_id', gettext('assembly #'))] %}
    {% set is_first = True %}
    {% for var, label in options %}
        {% if request.args.get(var) %}
        {% if not is_first %},{% endif %}
        {{ label }}&nbsp;<strong>{{ request.args.get(var) }}</strong>
        {% set is_first = False %}
        {% endif %}
    {% endfor %}
{%- endmacro %}

{% block title %}
{{ super() }} - {{ gettext("Search") }}
{% endblock %}

{% block breadcrumb_current %}
{{ gettext('search') }}
{% endblock %}

{% block extra_headers %}
<style>
#card-container {
    width: 0;
}

#spec-container {
    left: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="alert alert-info">
    {{ gettext('Search results by %(options)s', options=search_options()) }}
</div>
<table class="table table-condensed">
    <tbody>
        {% if not target or target == 'people' %}
        <tr>
            <th>
                {{ gettext('People') }}
                <br>{{ macro.list_count(people) }}
            </th>
            <td>{{ macro.people_list(people, show_pagenav=False) }}</td>
        </tr>
        {% endif %}
        {% if not target or target == 'parties' %}
        <tr>
            <th>
                {{ gettext('Party') }}
                <br>{{ macro.list_count(parties) }}
            </th>
            <td>{% call(party) macro.list(parties, show_pagenav=False) %}
                <a href="{{ url_for('party', id=party.id) }}">{{ party.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if not target or target == 'schools' %}
        <tr>
            <th>
                {{ gettext('School') }}
                <br>{{ macro.list_count(schools) }}
            </th>
            <td>{% call(school) macro.list(schools, show_pagenav=False) %}
                <a href="{{ url_for('search', target='people', school_id=school.id) }}">{{ school.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if not target or target == 'regions' %}
        <tr>
            <th>
                {{ gettext('Region') }}
                <br>{{ macro.list_count(regions) }}
            </th>
            <td>{% call(region) macro.list(regions, show_pagenav=False) %}
                <a href="{{ url_for('region', region_id=region.id) }}">{{ region.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if not target or target == 'bills' %}
        <tr>
            <th>
                {{ gettext('Bill') }}
                <br>{{ macro.list_count(bills) }}
            </th>
            <td>{% call(bill) macro.list(bills, show_pagenav=False) %}
                <a href="{{ url_for('bill', id=bill.id) }}">{{ bill.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
    </tbody>
</table>
{% endblock %}
