{% extends 'layout.html' %}
{% import 'macros.html' as macro with context %}

{% block title %}
{{ super() }} - {{ gettext("Search") }}
{% endblock %}

{% block extra_headers %}
{% assets filters='less', output='build/search.%(version)s.css',
    depends=['**/*.less'], 'less/search.less' %}
<link rel="stylesheet" href="{{ASSET_URL}}">
{% endassets %}
{% endblock %}


{% block card %}
<table class="table table-condensed table-bordered">
    {% set options = [('year', gettext('birthyear')),
                      ('query', gettext('query')),
                      ('school_id', gettext('school')),
                      ('candidacy_region_id', gettext('election district')),
                      ('residence_region_id', gettext('residential district')),
                      ('person_id', gettext('person')),
                      ('assembly_id', gettext('assembly #'))] %}

    {% for var, label in options %}
        {% if request.args.get(var) %}
            <tr><th class="no-min-width">{{ label }}</th><td>{{ request.args.get(var) }}</td><td><a href="{{ url_for_query(**{ var: None }) }}">x</a></td></tr>
        {% endif %}
    {% endfor %}
</table>
{% endblock %}

{% block content %}
<table class="table table-condensed">
    <tbody>
        <tr>
            <th>
                {{ gettext('People') }}
                <br>{{ macro.list_count(people) }}
            </th>
            <td>{{ macro.people_list(people, show_pagenav=False) }}</td>
        </tr>
        {% if parties %}
        <tr>
            <th>
                {{ gettext('Party') }}
                <br>{{ macro.list_count(parties) }}
            </th>
            <td>{% call(party) macro.list(parties, show_pagenav=False) %}
                <a href="{{ url_for('party', id=party.id) }}">{{ party.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if schools %}
        <tr>
            <th>
                {{ gettext('School') }}
                <br>{{ macro.list_count(schools) }}
            </th>
            <td>{% call(school) macro.list(schools, show_pagenav=False) %}
                <a href="{{ url_for('search', target='people', school_id=school.id) }}">{{ school.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if regions %}
        <tr>
            <th>
                {{ gettext('Region') }}
                <br>{{ macro.list_count(regions) }}
            </th>
            <td>{% call(region) macro.list(regions, show_pagenav=False) %}
                <span>{{ region.name }}</span>&nbsp;&nbsp;<small><a href="{{ url_for('search', target='people', candidacy_region_id=region.id) }}">{{ gettext('Candidates') }}</a>&nbsp;<a href="{{ url_for('search', target='people', residence_region_id=region.id) }}">{{ gettext('Residents') }}</a></small>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
        {% if bills %}
        <tr>
            <th>
                {{ gettext('Bill') }}
                <br>{{ macro.list_count(bills) }}
            </th>
            <td>{% call(bill) macro.list(bills, show_pagenav=False) %}
                <a href="{{ url_for('bill', id=bill.id) }}">{{ bill.name }}</a>
                {% endcall %}
            </td>
        </tr>
        {% endif %}
    </tbody>
</table>
{% endblock %}
